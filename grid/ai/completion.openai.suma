profile = "ai/completion@1.0"
provider = "openai"

map CreateCompletion {
    http POST "/v1/completions" {
      security "bearer_token"

      request 'application/json' {
        body {
          model = input.model
          prompt = input.prompt
          max_tokens = input.maxTokens || 100
        }
      }

    response 200 "application/json" {
      return map error if (!body.choices.length) {
        errCode = 'completion_failed'
        detail = 'No choices received.'
      }

      map result {
        text = body.choices[0].text
      }
    }

    response {
      map error {
        errCode = "unknown_response"
        detail = JSON.stringify(body, null, 2)
      }
    }
}
}
